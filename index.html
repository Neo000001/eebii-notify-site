<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Eebii Notify â€” Connect WhatsApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:640px;margin:40px auto;padding:0 16px}
    input,button{font-size:16px;padding:10px;border:1px solid #ccc;border-radius:8px}
    button{cursor:pointer}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .card{border:1px solid #eee;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 2px 6px rgba(0,0,0,.04)}
    label{display:block;margin:6px 0 4px;color:#333}
  </style>
</head>
<body>
  <h1>ðŸš€ Eebii Notify</h1>

  <div class="card">
    <h3>1) Connect WhatsApp (Embedded Signup)</h3>
    <p>Click the button, finish Metaâ€™s flow, then paste the <b>Phone Number ID</b> and <b>Access Token</b> below for this MVP.</p>
    <p><a id="signupLink" target="_blank" rel="noopener">
      <button>Open Meta Embedded Signup</button>
    </a></p>

    <div class="row">
      <div style="flex:1 1 260px">
        <label>Phone Number ID</label>
        <input id="phone_id" placeholder="e.g. 88018740xxxxx" style="width:100%"/>
      </div>
      <div style="flex:1 1 260px">
        <label>Access Token</label>
        <input id="token" placeholder="EAAG..." style="width:100%"/>
      </div>
    </div>
    <p><button onclick="saveCreds()">Save Connection</button></p>
    <pre id="saveOut"></pre>
  </div>

  <div class="card">
    <h3>2) Send a Template Message</h3>
    <div class="row">
      <div style="flex:1 1 260px">
        <label>To (E.164)</label>
        <input id="to" placeholder="+91XXXXXXXXXX" style="width:100%"/>
      </div>
      <div style="flex:1 1 260px">
        <label>Template name</label>
        <input id="tpl" value="hello_world" style="width:100%"/>
      </div>
    </div>
    <p><button onclick="sendMsg()">Send</button></p>
    <pre id="sendOut"></pre>
  </div>

<script>
  const API = "https://eebii-api.onrender.com"; // your Render API

  // TODO: replace REDIRECT with your success page later
  const APP_ID = "YOUR_APP_ID_HERE"; // 2262157087614555
  const REDIRECT = encodeURIComponent("https://eebii.com/success");
  const state = encodeURIComponent("eebii-state");
  document.getElementById("signupLink").href =
    `https://www.facebook.com/dialog/oauth?client_id=${APP_ID}&redirect_uri=${REDIRECT}&state=${state}`;

  async function saveCreds(){
    const payload = {
      phone_number_id: document.getElementById('phone_id').value.trim(),
      access_token: document.getElementById('token').value.trim()
    };
    const r = await fetch(`${API}/wa/connect`,{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    document.getElementById('saveOut').textContent = JSON.stringify(await r.json(), null, 2);
  }

  async function sendMsg(){
    const payload = {
      to: document.getElementById('to').value.trim(),
      template: document.getElementById('tpl').value.trim(),
      lang: "en_US",
      variables: []
    };
    const r = await fetch(`${API}/send2`,{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    document.getElementById('sendOut').textContent = JSON.stringify(await r.json(), null, 2);
  }
</script>
</body>
</html>
